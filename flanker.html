<!doctype html>
<html>

    <head>
        <title>the Flanker task</title>
        <!-- Load jQuery -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- Load the jspsych library and plugins -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-text.js"></script>
        <script src="scripts/plugins/jspsych-single-stim.js"></script>
        <script src="scripts/plugins/jspsych-categorize.js"></script>
        <!-- Load the stylesheet -->
        <link href="flanker.css" type="text/css" rel="stylesheet"></link>
    </head>

    <body>
        <div id="jspsych_target"></div>
    </body>

    <script>


        var flanker_instructions = "<div id='instructions'><p>In the next task, you will see a " +
            "series of images that look similar to this:</p><p>" +
            "<img src='img/incongruent_right.gif'></p><p style = 'text-align: left;''> Your task is to press the arrow " +
            "key that corresponds to the direction that the middle arrow while trying to ignore the arrows on the sides. " +
            "For example, in this case you would press the " +
            "right arrow key."+
            "</p><p>You will first go through a short trial where you can try out the experiment, and then have another information screen when "+
            "the experiment is about to start.</p>" +
            "<p style = 'text-align: center'>Press any key to start when you're ready!</p>";


        var flanker_intermezzo = "<div id='instructions'><p>You completed the training! The experiment will now follow.</p>" +
            "<br>Note that the images will now appear much faster! Try and respond as quickly and accurately as you can."+
            "<br>Also notice that you won't get feedback on correct and false responses during the experiment."+
            "<p style = 'text-align: center'>Press any key to start when you're ready!</p>";

       
       var test_images = [ 
        {stimulus:"img/congruent_left.gif", data: {type: "congruent", key: 'left'}}, 
        {stimulus:"img/congruent_right.gif", data: {type: "congruent", key: 'right'}}, 
        {stimulus:"img/incongruent_left.gif", data: {type: "incongruent", key: 'left'}}, 
        {stimulus:"img/incongruent_right.gif", data: {type: "incongruent", key: 'right'}}
        ];

        var flanker_training_answers = [];
        var flanker_training_text_answers = [];
        var flanker_training_images = [];

        //gets random image from test_images array and appends to answers and text_answers arrays
        //depending on the stimulus type and data attributes
        for (var i = 0; i < 12; i++) {
            var rnd = Math.round(Math.floor(Math.random() * 3));
            var image = test_images[rnd]; //random stimulus setting from test_images
            flanker_training_images.push(image.stimulus);
            if (image.data.key === 'left') {
                flanker_training_answers.push(37);
                flanker_training_text_answers.push("left");
            }
            else {
                flanker_training_answers.push(39);
                flanker_training_text_answers.push("right");
            }
        }

        var trial_images = jsPsych.randomization.repeat(test_images, 10, true);

        // Define experiment blocks
        var flanker_instruction_block = {
            type: "text",
            text: [flanker_instructions],
            timing_post_trial: 2500
            };

        var flanker_intermezzo_block = {
            type: "text",
            text: [flanker_intermezzo],
            timing_post_trial: 2500
        }

        var flanker_test_block = {
            type: "single-stim",
            stimuli: trial_images.stimulus,
            choices: [37, 39],
            data: trial_images.data //figure out a way to write this as congruent/incongruent
            };

         var flanker_training_block = {
            type: 'categorize',
            stimuli: flanker_training_images,
            key_answer: flanker_training_answers,
            text_answer: flanker_training_text_answers,
            choices: [37, 39],
            correct_text: "<p class='prompt'>Correct!</p>",
            incorrect_text: "<p class='prompt'>False!</p>",
            prompt: "<p class='prompt'>Press left arrow if the middle arrow points left, <br>and right arrow if the middle arrow points right.</p>"
        };


        jsPsych.init({
            display_element: $('#jspsych_target'),
            experiment_structure: [flanker_instruction_block, flanker_training_block, flanker_intermezzo_block, flanker_test_block],
            on_finish: function(data) {
                $("#jspsych_target").append($('<pre>', {
                    html: jsPsych.dataAsCSV()
                }));

                //jsPsych.saveCSVdata("data.csv");
            }
        });
        //JOSH'S INIT
        /*jsPsych.init({
            experiment_structure: [flanker_instruction_block, flanker_test_block, debrief_block],
            on_finish: function(data) {
            $('#jspsych_target').append($('<pre>', {
                html: JSON.stringify(data, undefined, 2)
            }))
          }        
        });*/

    </script>
</html>